{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-02-09-aws-from-front-end-perspective/","result":{"data":{"site":{"id":"Site","siteMetadata":{"title":"brain's base","author":"Jeff Chheng"}},"markdownRemark":{"id":"5fede76e-a91e-5fd8-8336-492e667b712d","excerpt":"EC2? ELB? IAM? What? Do you not know much about AWS/infrastructure and wanna learn more, at least a high level? I'll do my best to explain things from a frontâ€¦","html":"<p>EC2? ELB? IAM? What?</p>\n<p>Do you not know much about AWS/infrastructure and wanna learn more, at least a high level? I'll do my best to explain things from a front end engineer's perspective.</p>\n<h2>Background</h2>\n<p>I've been working on a project to create a template for bootstrapping apps. It's Next.js and TypeScript with some boilerplate code that handles OAuth, connecting with our microservices, all that. We want devs to build apps and not worry about configs or tooling. Easy peasy.</p>\n<p>Alas, a front end solution isn't enough, because part of our CI/CD infra is reaching EOL. We don't want to recommend or build on something that'll have to be replaced soon. And devops and infra is just difficult to manage for every non-devops engineer in general, so why not make that easy too?</p>\n<p>It took a while, but I eventually got something working that's much easier to set up and more self-service. Now I'm ready to share all I've learned about AWS from the perspective of a front end engineer who initially hated it (and still kind of does).</p>\n<h2>Onward to AWS</h2>\n<p>Here are the tools I've landed on for somewhat easy-to-use, self-serve, production-ready, and secure web apps.</p>\n<h3>CodeStar</h3>\n<p>The template is based on CodeStar.</p>\n<p>It's an all-in-one solution by AWS that will provision resources, create a pipeline, create access roles for its service workers, and so on.</p>\n<p>An admin needs to allow CodeStar access for the entire account, then you simply need someone to add the CodeStar, CodeBuild, CodeDeploy, CodePipeline access policies to your user role and limit the resources to projects under your team's control, and you're good to go.</p>\n<h3>CodeBuild, -Deploy, -Pipeline</h3>\n<p>CodeBuild handles building from your source (GitHub or CodeCommit). You can specify environment variables through a fairly easy-to-use console.</p>\n<p>CodeDeploy handles \"deployment groups\" (i.e., the environments you want to deploy an app, such as test, staging, and prod).</p>\n<p>CodePipeline ties your source control, build, and deploy into one neat pipeline. You can add actions for test, staging, and prod. One stage flows into the next until everything's done.</p>\n<h3>CloudFormation</h3>\n<p>CodeStar automatically creates a template.yml. In the template, you describe resources you want like \"a small server,\" \"route my traffic to a pretty URL,\" \"these're my certifates,\" \"only let these IPs access my app,\" etc.</p>\n<p>CloudFormation takes that template, compares it with your previous template, and it creates, updates, or deletes the resources you've added, changed, or removed.</p>\n<p>It's declarative, like React. However, you have to be careful and delibrate when updating the template, or you can confuse CloudFormation, which will require your devops team or AWS support to fix it for you.</p>\n<p>My rule of them here has been to take things slow and never change the template or retry failed changes until a rollback has completed.</p>\n<h3>VPC - Virtual Private Cloud</h3>\n<p>I'll be honest: I don't really know how this works. To my knowledge, you have a VPC that sections off your part of the Amazon cloud. So you physically share AWS resources with other companies, but they're logically separated.</p>\n<p>Then there are subnets that specify IP ranges that can access to your resources. For example, you can have a private subnet that only allows internal traffic on your company's network/VPN, in addition to a public subnet for external-facing sites.</p>\n<p>These can be further limited by security groups, so only resources internal to your section of the cloud can access it.</p>\n<p>This is the part I know the least about AWS. I'm glad our devops team figured all this out, and I just get to use it.</p>\n<h3>Route 53</h3>\n<p>DNS names and forwarding!</p>\n<p>Here you can define something like <code class=\"language-text\">*.company.com</code> and <code class=\"language-text\">*.internalonly.com</code>. When someone sets up a record like <code class=\"language-text\">accounts.internalonly.com</code>, it will only forward traffic from internal IPs.</p>\n<h3>EC2 - Elastic Cloud Compute</h3>\n<p>You rent servers (instances) from Amazon and pay per hour of use.</p>\n<p>You can limit access through the VPC, subnets, and security groups. As far as I can tell, you can't even access an EC2 instance with a public IP if it's on a private subnet. Still, I'd set a security group to be sure.</p>\n<h3>ELB - Elastic Load Balancing</h3>\n<p>So you have an EC2 instance or many, and they have really hard to remember IPs like <code class=\"language-text\">10.0.150.1</code> or <code class=\"language-text\">10.0.160.1</code>? Setting up an Application Load Balancer (ALB) will handle traffic and pass it to the correct instance. This is helpful if you have instances in multiple geographic locations, and you want to make sure users connect to the fastest one for them.</p>\n<p>You have a listener on the ALB for traffic on port 443 with an SSL certificate, for example. You define a target group as the EC2 instance's port 80 (where your app is running).</p>\n<p>Finally, you need to define a Route 53 record set that describes your hosted zone (e.g., <code class=\"language-text\">internalonly.com</code> or <code class=\"language-text\">company.com</code>) and the actual name you want like <code class=\"language-text\">accounts.internalonly.com</code>.</p>\n<p>When someone hits <code class=\"language-text\">https://accounts.internalonly.com</code>,</p>\n<ol>\n<li>Route 53 sees a matching set</li>\n<li>It forwards traffic to the ALB</li>\n<li>ALB sees you're hitting port 443 (HTTPS) that it's listening for</li>\n<li>It forwards that to the best EC2 instance it can (the target group)</li>\n<li>EC2 instance handles it, and returns the response back up the chain</li>\n</ol>\n<h3>IAM - Identity and Access Management</h3>\n<p>How do you allow/deny access to certain things? That's IAM. It keeps track of roles and policies.</p>\n<p>A role can be something like job role \"senior-developer\" or \"junior-developer,\" or it can be team-based like \"team-edward\" or \"team-jacob.\"</p>\n<p>Policies describe four things:</p>\n<ol>\n<li><code class=\"language-text\">Action</code> - what you can do (e.g., run an EC2 instance, create a traffic forwarding rule)</li>\n<li><code class=\"language-text\">Resource</code> - what you can use (e.g., only allow internal subnets or hosted zones to be used)</li>\n<li><code class=\"language-text\">Effect</code> - whether you're allowed or denied access to the above</li>\n<li><code class=\"language-text\">Condition</code> - pattern matching conditional (e.g., you can only run micro or small EC2 instances)</li>\n</ol>\n<p>In this way, you can make sure only admins can wholesale delete resources and let something like CodeStar manage resources it has created. Devs should generally describe what they want in a CloudFormation template and let AWS take care of the rest.</p>\n<p>For example, here's a reusable policy to limit what subnets CodeStar can run an EC2 instance on:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ec2:RunInstances\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:subnet/subnet-SUBNET_ID_01\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:subnet/subnet-SUBNET_ID_02\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:subnet/subnet-SUBNET_ID_03\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:subnet/subnet-SUBNET_ID_04\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:network-interface/*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:instance/*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:volume/*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*::image/ami-*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:key-pair/*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:ec2:*:*:security-group/*\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Condition\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"StringEquals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"ec2:InstanceType\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"t2.nano\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"t2.micro\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"t2.small\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This prevents someone from creating a CodeStar template that is hosted on an internet-facing EC2 instance that anyone can access by default. It also prevents them from using expensive instances. AWS doesn't allow limiting the number of resources that can be created by a template, but fingers crossed that's coming soon.</p>\n<p>Then there's this template that will prevent someone from forwarding traffic from an internal instance an external ALB.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"route53:GetChange\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"route53:GetHostedZone\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"route53:ListHostedZones\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"route53:ListHostedZonesByName\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"route53:ListResourceRecordSets\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"route53:GetHostedZoneCount\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"route53domains:*\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"route53:ChangeResourceRecordSets\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"route53:ListResourceRecordSets\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"apigateway:GET\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"arn:aws:route53:::hostedzone/HOSTED_ZONE_ID\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"arn:aws:apigateway:*::/domainnames\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>By adding these policies and <code class=\"language-text\">ElasticLoadBalancingFullAccess</code> to <code class=\"language-text\">CodeStarWorker-MY_APP-CloudFormation</code>, you'll be able to create internal-only EC2 instances and ALBs via CodeStar. No one but rogue admins would be able to allow access otherwise.</p>\n<h2>Final thoughts</h2>\n<p>AWS is super complicated, but I'm glad they're taking steps to create more complete solutions like CodeStar that abstracts a lot of the complicated stuff away.</p>\n<p>Sure, it's not a completely foolproof solution, but it's a good starting point for people like me who had no idea how to get started otherwise. By using CodeStar as a base, I'm able to explore solutions that make sense in context instead of having all of AWS thrown at me.</p>\n<p>I hope you all found my explanations of AWS tools and concepts helpful and not <em>too</em> inaccurate. </p>","frontmatter":{"title":"AWS from a front end engineer's perspective","date":"February 09, 2020","description":"EC2? ELB? IAM? What?"}}},"pageContext":{"slug":"/2020-02-09-aws-from-front-end-perspective/","previous":{"fields":{"slug":"/2020-01-17-movie-roundup/"},"frontmatter":{"title":"November, December, January Movie Roundup"}},"next":null}}}